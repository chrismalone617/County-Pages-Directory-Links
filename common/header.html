<script type="text/discourse-plugin" version="0.8">
  api.onPageChange((url, title) => {
    // Only run on category pages
    if (!url.includes('/c/')) {
      return;
    }
    
    // Wait for page to load
    setTimeout(() => {
      // Check if we already added the header (avoid duplicates)
      if (document.querySelector('.county-category-header')) {
        return;
      }
      
      // County data array - add all county information here
      const counties = [
        {
          slug: 'reeves-county-tx',
          imageUrl: '/uploads/db5755/original/3X/3/7/378e553519f9d393623059dd6beadbe1593cc79e.jpg',
          linkUrl: 'https://reeves-county-texas.mineralrightsforum.com/',
          categoryPage: 'https://your-forum-url.com/c/parent-category/reeves-county-tx'
        }
        // Add more counties here:
        // {
        //   slug: 'ward-county-tx',
        //   imageUrl: '/images/ward-county.jpg',
        //   linkUrl: 'https://ward-county-texas.mineralrightsforum.com/',
        //   categoryPage: 'https://your-forum-url.com/c/parent-category/ward-county-tx'
        // },
      ];
      
      // Find matching county by comparing current URL with categoryPage
      // Normalize URLs for comparison (remove protocol, trailing slashes, query params)
      const normalizeUrl = (url) => {
        try {
          const urlObj = new URL(url);
          return urlObj.pathname.replace(/\/$/, '').toLowerCase();
        } catch (e) {
          // Fallback if URL parsing fails
          return url.split('?')[0]
                    .replace(/^https?:\/\//, '')
                    .replace(/\/$/, '')
                    .toLowerCase();
        }
      };
      
      const currentPath = normalizeUrl(window.location.href);
      const matchingCounty = counties.find(county => {
        const countyPagePath = normalizeUrl(county.categoryPage);
        // Match if paths are the same after normalization
        return currentPath === countyPagePath;
      });
      
      // If no matching county found, don't show header
      if (!matchingCounty) {
        return;
      }
      
      // Find where to insert the header (before topic list or after category title)
      const insertPoint = document.querySelector('.category-title, .topic-list, .category-list');
      if (!insertPoint) {
        return;
      }
      
      // Create header HTML
      const headerHTML = `
        <div class="county-category-header">
          <a href="${matchingCounty.linkUrl}" target="_blank" rel="noopener noreferrer" class="county-header-link">
            <img src="${matchingCounty.imageUrl}" alt="${matchingCounty.slug}" class="county-header-image" />
          </a>
        </div>
      `;
      
      // Insert before the insert point
      insertPoint.insertAdjacentHTML('beforebegin', headerHTML);
    }, 500); // Wait 500ms for page to fully load
  });
</script>

